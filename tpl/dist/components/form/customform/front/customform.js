define("/tpl/dist/components/form/customform/front/customform",["coms/frontbase","lib/zepto-plugin/form","lib/utils/tips","lib/utils/comUtils","pages/append/base.css"],function(t,e,i){var o=t("coms/frontbase"),a=t("lib/zepto-plugin/form"),r=t("lib/utils/tips"),n=t("lib/utils/comUtils"),s=navigator.userAgent.indexOf("Android")>-1;n.isIos();return t("pages/append/base.css"),{init:function(t,e){var i,d=a("body").height(),c=new o(t.attrs,e);c.init(t,{setInnerHTML:function(e){if(!e.data.innerHTML)return e.data.dom.innerHTML="";var i=n.getTransfrom(e.data.innerHTML);n.setTransfrom(e.data.dom,i.tf),e.data.dom.innerHTML=i.str;var o=a(e.data.dom).find("form");o.length>=1&&(o[0].id=t.data.formID)}});var f=a(c.curDom),l=a("#pages");f.find("form").attr("onsubmit","return false"),f.find("input,textarea").removeAttr("disabled").filter("textarea").val("");var u=!1;return f.delegate(".c-customform-inner form","click",function(t){var e=a(this);n.checkAppLogin(function(){e.off("click"),u=!0}),t.stopPropagation()}),s&&(f.delegate(".c-customform-field input, .c-customform-field textarea","focus",function(t){var e=a(this);setTimeout(function(){var t=e.offset().top,o=a(window).height();t+e.height()>o/2&&l.css({marginTop:-(t-o/2)}),i=setInterval(function(){d<=a("body").height()&&(l.css({marginTop:0}),clearInterval(i))},500)},500)}),f.delegate(".c-customform-field input, .c-customform-field textarea","change",function(t){}),f.delegate(".c-customform-field input, .c-customform-field textarea","blur",function(t){})),f.delegate(".c-customform-btns input","click",function(t){if(t.preventDefault(),u){if(!n.isWeixin())return window.open('weixin://dl/business/?t=6eGCeE5Na7a');var e,i=a(this).closest("form"),o="",s={text:function(t){return t&&t.replace(/\s+/g,"")?null:(this.getAttribute("placeholder")||"")+"不能为空"},tel:/^((\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)$/gi,email:/(^[a-z\d]+(\.[a-z\d]+)*@([\da-z](-[\da-z])?)+(\.{1,2}[a-z]+)+$)/gi};if(_.each(i.find('input:not([disabled]):not([type="button"])'),function(t,i){if(!(t.disabled||t.readOnly||"button"==t.type||o)){var r=e=a(t);r.parent().removeClass("z-error");var n=s[t.type];return a.isFunction(n)?"姓名"==t.placeholder&&(o=n.call(t,r.val()),!1):!n||a.trim(r.val()).match(s[t.type])||o?void 0:(o=r.attr("placeholder")+"格式不正确",!1)}}),o)return r.info(o),e.focus().parent().addClass("z-error"),!1;var d=liveApp.caseIns.getCaseData(),c={case_id:d.pageList?d.id:-1,form_id:i.attr("id"),page_id:i.closest(".page").attr("id").replace("page-",""),data:{}},f=window.location.search.indexOf("point"),l="";f!=-1&&(l=window.location.search.substr(f),c.data.point=l.split("&")[0].valueOf().split("=")[1]),_.each(i.serializeArray(),function(t,e){c.data[t.name]=t.value}),n.checkAppLogin(function(){r.loading("正在提交..."),a.ajax({url:"/ci/guest/form/submit",type:"post",data:c,success:function(t){t=JSON.parse(t),200==t.ecode?(r.hide(),r.success("提交成功"),i.get(0).reset()):405==t.ecode?(r.hide(),console.info(t),console.info(c),c.id=t.data.id,n.ConfirmDialog.show({title:"是否替换回执？",content:"您已经发表回执，是否替换之前提交回执内容？",okFun:function(){r.loading("正在提交..."),a.ajax({url:"/ci/guest/form/update",type:"post",data:c,success:function(t){t=JSON.parse(t),200==t.ecode?(r.hide(),r.success("提交成功"),i.get(0).reset()):(r.hide(),r.error(t.msg))},error:function(t){r.hide(),r.error("提交失败")}})}})):(r.hide(),r.error(t.msg))},error:function(t){r.hide(),r.error("提交失败")}})})}}),c}}});